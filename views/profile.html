{% extends 'layout.html' %}
{% block login %}
  <div class="login-block">
    <div class="banner-login">
            <a id="my-profile" href="/profile" class="btn"><img id="welcomeImg" src="/img/welcome_noonsong.png" style="width:38px;height:38px;z-index:2"></a>
            <span>{{'ì•ˆë…•í•˜ì„¸ìš”, ' + user.nick + 'ì†¡!'}}</span>
            <a id="logout" href="/auth/logout" class="btn" style="text-decoration:none;"><button class="logout">Sign Out</button></a>
    </div>  
  </div>
{%endblock%}
{% block profile %}
<div class="container2">
<div class='upper-profile'>
    <div id="profile-img">
        <p id="profile-tag">âœ¨ í”„ë¡œí•„</p>
        {% if user.level>=0 and user.level< 10 %}
            <img src="/img/level1_noonsong.png">       
        {% elif user.level>=10 and user.level < 30 %}
            <img src="/img/level2_noonsong.png">
        {% elif user.level >= 30 and user.level < 9999 %}
            <img src="/img/level3_noonsong.png">
        {% elif user.level >= 9999 %}
            <img src="/img/master_noonsong.png">
        {%endif%}
    </div>
    <div id="profile-form"> 
        <form id="update-profile" action="/user/fix" method="post">   
            <div>name :<input type="text" id="edit-nick" name="nick" value="{{user.nick}}" maxlength='15' style="width:200px;height:30px;font-size:1em"></div>
            <div class="profile-level">level : {{user.level}}</div>
            <div class="profile-level">
                {% if user.level_show == 0 %} 
                <input type="radio" name="chk" value=0 checked="checked">ê³µê°œ 
                <input type="radio" name="chk" value=1>ë¹„ê³µê°œ
                {% else %}
                <input type="radio" name="chk" value=0 >ê³µê°œ
                <input type="radio" name="chk" value=1 checked="checked" >ë¹„ê³µê°œ
                {% endif %}
            </div>
            <div id="email">email : {{user.email}}</div>
            <button id="edit" class="btn btn-outline-primary" value="ìˆ˜ì •" type="submit">ìˆ˜ì •</button>
        </form>        
    </div>
    <div id="my-posts">
        <p>ğŸ“ ë‚˜ì˜ ë‹¤ì§</p>
            <div class="my-post">
            {%set Postnum=0%}
            {% for promise in promises %}
                {%set Postnum=Postnum+1%}
                {%set likerNum=0%}
                {%for like in promise.Liker%}
                    {%set likerNum=likerNum+1 %}
                {%endfor%}
                <div class="postlike force-overflow">
                    <div class="post-cont">{{promise.msg}}</div>
                    <div class="post-like"><span>{{likerNum}}ëª…ì´ ì¢‹ì•„í•©ë‹ˆë‹¤</span>  <button class="p-delete" value="{{promise.id}}"><i class="fas fa-trash-alt"></i></button></div>
                </div>
            {% endfor %}
            {%if Postnum==0%}
                <div class="postlike force-overflow">
                    <div class="post-cont">ì•„ì§ ì‘ì„±í•œ ë‹¤ì§ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                    <div class="post-like">ë©”ì¸í™”ë©´ì—ì„œ ë‹¤ì§ì„ ë‚¨ê²¨ ë³´ì„¸ìš”!</div>
                </div>
            {%endif%}  
            </div>  
    </div>
</div> <!--upper-profileë-->

<div class="lower-profile">
    <div class="level-container">
        <p>ğŸ”¥ ë ˆë²¨ ì—…</p>
        <div id="next-level">
                {% set total_time = user.total_time %}
                {% set H=total_time//3600 %}
                {% set total_time=total_time-H*3600%}
                {% set total_time = total_time*10/6 %}
                {% set M=total_time//100%}
                {%set percent=M/60*100%}
            <div class="w3-light-grey w3-round-xlarge"><img id="noonsong" src="/img/bar1_noonsong.png" style="left:{{percent}}%;">
            <div class="w3-container w3-padding-large  w3-indigo w3-round-xlarge" style="width:{{percent}}%"></div></div>
            <div id="percent"><div id="left-percent">0%</div><div id="right-percent">100%</div></div>
            <div id="level-text">
                <div>ì´ ê³µë¶€ ì‹œê°„:
                {{H}}ì‹œê°„
                {{M}}ë¶„
                {% set total_time = total_time-M*100 %}
                {% set S=total_time*0.6%}
                {{S//1}}ì´ˆ</div>

                <div>ë‹¤ìŒ levelê¹Œì§€ 
                {%set leftM=60-M%}
                {{leftM}}ë¶„
                í•„ìš”í•©ë‹ˆë‹¤.</div>
            </div>
        </div>
    </div> <!--level-containerë-->
</div>
</div>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script>
    document.querySelectorAll('.p-delete').forEach(function(tag) {
        tag.addEventListener('click', function() {
          const promiseId = tag.value;
          console.log(promiseId)
            if (confirm('ê²Œì‹œê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            axios.delete(`/post/${promiseId}`)
            // ë°”ë¡œ í¬ìŠ¤íŠ¸ ì‚­ì œë˜ë„ë¡
                .then(() => {
                location.reload();
                })
                .catch((err) => {
                console.error(err);
                });
            }
       });
      });
</script>
{%endblock%}
{%block script%}
<script>
    let logoA=document.getElementById('logoA');
    logoA.setAttribute('href','/');
    let homeA=document.getElementById('homeA');
    homeA.setAttribute('href','/');
    let ranking=document.getElementById('rankingA');
    rankingA.setAttribute('href','http://localhost:8001/#ranking');
    let promiseA=document.getElementById('promiseA');
    promiseA.setAttribute('href','http://localhost:8001/#promise');
    let profileA=document.getElementById('profileA');
    profileA.setAttribute('href','#');
    let leftline=document.querySelector('.left-line');
    let navbar=document.querySelector('.navbar');
    leftline.style.height='100%';
    navbar.style.height='500px';
</script>
{%endblock%}